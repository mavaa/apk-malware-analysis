import csv
import sqlite3
import gzip
import os

dbfile='androzoo.sqlite'
if os.path.exists(dbfile):
    os.remove(dbfile)

con = sqlite3.Connection(dbfile)
cur = con.cursor()
cur.execute('CREATE TABLE "apps" (' +
        '"sha256" varchar(64),' +
        '"sha1" varchar(40),' +
        '"md5" varchar(32),' +
        '"dex_date" datetime,' +
        '"apk_size" int,' +
        '"pkg_name" varchar(50),' +
        '"vercode" int,' +
        '"vt_detection" int2,' +
        '"vt_scan_date" datetime,' +
        '"dex_size" int,' +
        '"markets" varchar(40)' +
        ');')

f = gzip.open('latest.csv.gz', 'rt')
csv_reader = csv.reader(f, delimiter=',')

for line in csv_reader:
    if line[0] == 'sha256':
        print("header")
        print(line)
    elif ',snaggamea' in line:
        print(line)
    else:
        # print(line)
        cur.execute('INSERT INTO apps VALUES (?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?)', line)

cur.close()
con.commit()
con.close()
f.close()

