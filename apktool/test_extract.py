import extractor
import sqlite3

# App name and file paths
package_name = "cn.buding.moviecoupon"
sha256sum = "d8a7bb9dcfe820023637e24728f0c9e14c3889e931080652b6c2f8d1b5467a40".upper()
app = package_name + ".apk"
app_path = "apps/m/" + app # Where to find the apk
out_path = "decoded/m/" + app # Where to put the extracted folder

# Extract the apk file (Only needed to run once per app, remove comment if needed)
# extractor.extract_app(app_path)

# Load the app manifest
# manifest = extractor.load_manifest(out_path)

# Get the nuber of activities defined
# number_of_activities = extractor.get_number_of_activities(manifest)
# print("Found " + str(number_of_activities) + " activities")
# print()

# Search for permissions
# permissions = extractor.get_permissions(manifest)
# print("Found " + str(len(permissions)) + " permissions:")
# print(permissions)
# print()

# Search for ipv4 addresses
# files_with_ips = extractor.get_ip_files(out_path)
# print("Found " + str(len(files_with_ips)) + " files containing ipv4 addresses:")
# print(files_with_ips)


# Write a line to a csv file
# extractor.add_csv_line(app_path, out_path, "test.csv")

# Get file info from virus total
app_info = extractor.get_vt_info(sha256sum)

out_file = open("result.json", "wb")
out_file.write(app_info)
out_file.close()
