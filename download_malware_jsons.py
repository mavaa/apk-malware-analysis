import vtapi.vtapi as vtapi
import sqlite3
import os

app_table = "app_data/random_malware.sqlite"
out_path = "app_data/malware_jsons"

con = sqlite3.Connection(app_table)
cur = con.cursor()

dl_apps = cur.execute("SELECT * FROM apps;").fetchall()

if not os.path.exists(out_path):
    os.makedirs(out_path)

count=1
total=str(len(dl_apps))
for app in dl_apps:
    out_filename = out_path + os.sep + app[0] + ".json"
    if os.path.exists(out_filename):
        print(out_filename + " exists, skipping...")
    else:
        json = vtapi.get_vt_info(app[0])

        file = open(out_filename, "wb")
        file.write(json)
        file.close()
        print("Fetched " + str(count) + " of " + total)
    count += 1
