import vtapi.vtapi as vtapi
import sqlite3
import os

app_table = "random_malware.sqlite"
out_path = "26_random_maljsons"

con = sqlite3.Connection(app_table)
cur = con.cursor()

dl_apps = cur.execute("SELECT * FROM apps;").fetchall()

if not os.path.exists(out_path):
    os.makedirs(out_path)

count=1
total=str(len(dl_apps))
for app in dl_apps:
    json = vtapi.get_vt_info(app[0])

    file = open(out_path + os.sep + app[5] + ".json", "wb")
    file.write(json)
    file.close()
    print("Fetched " + str(count) + " of " + total)
    count += 1
