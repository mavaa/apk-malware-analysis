import vtapi.vtapi as vtapi
import sqlite3
import os

apikey_vt = "*VT API KEY*"
app_table = "random_apps.sqlite"
out_path = "100_random_jsons"

con = sqlite3.Connection(app_table)
cur = con.cursor()

dl_apps = cur.execute("SELECT * FROM apps;").fetchall()

if not os.path.exists(out_path):
    os.makedirs(out_path)

count=1
total=str(len(dl_apps))
for app in dl_apps:
    json = vtapi.get_vt_info(app[0], apikey_vt)

    file = open(out_path + os.sep + app[5] + ".json", "wb")
    file.write(json)
    file.close()
    print("Fetched " + str(count) + "of " + total)
    count += 1
