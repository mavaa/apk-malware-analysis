import apktool.extractor as extractor
import generator.generator as generator
import vtapi.vtapi as vtapi
import sqlite3

# App name and file paths
# package_name = "cn.buding.moviecoupon"
#sha256sum = "d8a7bb9dcfe820023637e24728f0c9e14c3889e931080652b6c2f8d1b5467a40".upper()

apps = [
    "cn.buding.moviecoupon",
    "com.briox.riversip.android.premier.transfers",
    "com.chaocard.vcard",
    "com.guoran.rollingpaint",
    "com.justfree.GunTrigger",
    "com.mobile17173.game",
    "com.tixa.enterclient468",
    "com.wDubLiNW",
    "io.makeroid.madm20977.Yuvraj_Singh",
    "the.hexstudios.touchdisable.touchlock"
]

for package_name in apps:

    app = package_name + ".apk"
    app_path = "apps/m/" + app # Where to find the apk
    out_path = "decoded/m/" + app # Where to put the extracted folder

    # Extract the apk file (Only needed to run once per app, remove comment if needed)
    # extractor.extract_app(app_path, out_path)

    # Load the app manifest
    # manifest = extractor.load_manifest(out_path)

    # Get the nuber of activities defined
    # number_of_activities = extractor.get_number_of_activities(manifest)
    # print("Found " + str(number_of_activities) + " activities")
    # print()

    # Search for permissions
    # app_permissions = extractor.get_permissions(manifest)
    # print("Found " + str(len(app_permissions)) + " permissions:")
    # print(app_permissions)
    # print()

    # Search for ipv4 addresses
    # ipv4s = extractor.search_ip_in_files(out_path)
    # print("Found " + str(len(ipv4s)) + " ipv4 addresses:")
    # print(ipv4s)

    # Search for domains
    # domains = extractor.search_domains_in_files(out_path)
    # print("Found " + str(len(domains)) + " domains:")
    # print(domains)

    # Get number of files
    #num_files = extractor.count_files(out_path)
    #print("Apk contains " + str(num_files) + " files")

    # Get cert country code
    print(app + ": " + extractor.get_cert_country(out_path))

    # Write a line to a csv file
    # generator.add_csv_line(app_path, out_path, "test.csv", app_permissions, len(ipv4s))

    # Get file info from virus total
    # app_info = vtapi.get_vt_info(sha256sum)

    # out_file = open("result.json", "wb")
    # out_file.write(app_info)
    # out_file.close()
