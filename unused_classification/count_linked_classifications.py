import os
import json

jsondir = 'app_data/malware_jsons/'
top_classifications = [ "adware", "trojan", "virus", "spyware" ]

search_for=input("Search for: ")
classification_links = []

# Here we do a few things:
# - Search for the text in all json files
# - In every json file the text was found, get all classifications
# - These are "links" ie apps classified as the search word was also classified as the link classifications
for json_filename in os.listdir(jsondir):
    js_data = json.load(open(jsondir + json_filename, "r"))
    analysis_data = js_data["data"]["attributes"]["last_analysis_results"]

    for key in analysis_data:
        category = analysis_data[key]["category"]
        result = analysis_data[key]["result"]
        if category == "malicious" and result is not None:
            if search_for.lower() in result.lower():
                # Fetch all classifications in current app
                for key_2 in analysis_data:
                    result_2 = analysis_data[key_2]["result"]
                    if result_2 is not None:
                        classification_links.append(result_2.lower())

# Remove link duplicates
classification_links = list(dict.fromkeys(classification_links))

classifications_text = " ".join(classification_links)

# Count the number of occurances of each "top" classification
# The winning number is the "parent" classification to use
# print("CText: " + classifications_text)
print("Classifications linked to " + search_for + ":")
for top_class in top_classifications:
    print(top_class + ": " + str(classifications_text.count(top_class)))


